{% extends "base.html" %}

{% block header_actions %}
  {% if show_context %}
  <a class="inline-flex items-center rounded-md border border-slate-700 px-3 py-1.5 text-xs font-medium uppercase tracking-wide text-slate-300 hover:bg-slate-800" href="/chat">Hide Context</a>
  {% else %}
  <a class="inline-flex items-center rounded-md border border-slate-700 px-3 py-1.5 text-xs font-medium uppercase tracking-wide text-slate-300 hover:bg-slate-800" href="/chat?context=1">Show Context</a>
  {% endif %}
{% endblock %}

{% block content %}
<div class="grid gap-5 xl:grid-cols-[18rem_minmax(0,1fr)] xl:h-[calc(100vh-13rem)]">
  <section class="rounded-xl border border-slate-800 bg-slate-900/70 p-4">
    <div class="mb-3 text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-400">Presence</div>
    <div id="presence-island" class="space-y-2" hx-get="/ui/presence" hx-trigger="load" hx-swap="innerHTML">
      <div class="text-sm text-slate-500">Loading presence...</div>
    </div>
  </section>

  <section class="chat-panel flex min-h-0 flex-col rounded-xl border border-slate-800 bg-slate-900/70 p-4">
    <div class="mb-3 text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-400">Chat Timeline</div>
    <div class="mb-4 min-h-0 flex-1 space-y-2 overflow-y-auto rounded-lg border border-slate-800 bg-slate-950/60 p-3" id="chat-timeline" hx-get="/chat/timeline" hx-trigger="load, every 2s" hx-swap="innerHTML">
      <div class="text-sm text-slate-500">Loading timeline...</div>
    </div>
    <form class="composer space-y-3" hx-post="/chat/messages" hx-target="#chat-timeline" hx-swap="innerHTML">
      <label class="block space-y-1">
        <span class="text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-400">Message</span>
        <textarea class="w-full rounded-lg border border-slate-700 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-slate-500 focus:outline-none" name="message" rows="3" placeholder="Write a command or signal"></textarea>
      </label>
      <input type="hidden" name="correlation_id" value="" />
      <div>
        <button class="inline-flex items-center rounded-md border border-slate-600 bg-slate-800 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-slate-100 hover:bg-slate-700" type="submit">Send</button>
      </div>
    </form>
  </section>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/presence_island.js" defer></script>
<script src="/static/js/chat_composer_island.js" defer></script>
{% endblock %}
