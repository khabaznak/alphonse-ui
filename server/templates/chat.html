{% extends "base.html" %}

{% block header_actions %}
  {% if show_context %}
  <a class="button ghost" href="/chat">Hide Context</a>
  {% else %}
  <a class="button ghost" href="/chat?context=1">Show Context</a>
  {% endif %}
{% endblock %}

{% block content %}
<div class="chat-layout">
  <section class="panel">
    <div class="panel-title">Presence</div>
    <div id="presence-island" class="panel-body" hx-get="/ui/presence" hx-trigger="load" hx-swap="innerHTML">
      Loading presence...
    </div>
  </section>

  <section class="panel chat-panel">
    <div class="panel-title">Chat Timeline</div>
    <div class="chat-timeline" id="chat-timeline" hx-get="/chat/timeline" hx-trigger="load" hx-swap="innerHTML">
      Loading timeline...
    </div>
    <div id="chat-stream-island" class="island-mount">
      <div class="island-note">Chat stream optional island (disabled)</div>
    </div>
    <form class="composer" hx-post="/chat/messages" hx-target="#chat-timeline" hx-swap="innerHTML">
      <label class="field">
        <span class="field-label">Message</span>
        <textarea name="message" rows="3" placeholder="Write a command or signal"></textarea>
      </label>
      <input type="hidden" name="correlation_id" value="" />
      <div class="composer-actions">
        <button class="button" type="submit">Send</button>
      </div>
    </form>
  </section>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/presence_island.js" defer></script>
<script src="/static/js/chat_stream_island.js" defer></script>
{% endblock %}
